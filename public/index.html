<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulaire Inscription</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      :root {
        --tg-theme-bg-color: #fff;
        --tg-theme-text-color: #000;
        --tg-theme-button-color: #3390ec;
        --tg-theme-button-text-color: #fff;
        --tg-theme-secondary-bg-color: #f4f4f5;
        --tg-theme-hint-color: #999;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        background-color: var(
          --tg-theme-secondary-bg-color
        ); /* Fond gris clair */
        color: var(--tg-theme-text-color);
        margin: 0;
        padding: 15px;
      }

      h2 {
        margin-top: 0;
        color: var(--tg-theme-button-color);
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .card {
        background-color: var(--tg-theme-bg-color);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 12px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-size: 13px;
        color: var(--tg-theme-hint-color);
        font-weight: 500;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-sizing: border-box;
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
        font-size: 16px; /* Taille lisible mobile */
        outline: none;
        transition: border-color 0.2s;
      }

      input:focus,
      select:focus {
        border-color: var(--tg-theme-button-color);
      }

      /* Boutons Radio pour l'Option */
      .radio-group {
        display: flex;
        gap: 10px;
      }
      .radio-label {
        flex: 1;
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        background: var(--tg-theme-bg-color);
      }
      .radio-label.selected {
        background-color: var(--tg-theme-button-color);
        color: var(--tg-theme-button-text-color);
        border-color: var(--tg-theme-button-color);
        font-weight: bold;
      }
      input[type="radio"] {
        display: none;
      }

      /* Bouton Principal */
      #main-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        background-color: var(--tg-theme-button-color);
        color: var(--tg-theme-button-text-color);
        font-size: 16px;
        font-weight: bold;
        padding: 15px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 100;
      }

      /* Espace en bas pour ne pas cacher le contenu derri√®re le bouton */
      .spacer {
        height: 80px;
      }
    </style>
  </head>
  <body>
    <h2>üë§ D√©tails de l'√©l√®ve</h2>
    <div class="card">
      <div class="form-group">
        <label>Nom Complet *</label>
        <input type="text" id="nomComplet" placeholder="Ex: Jean Rakoto" />
      </div>
      <div class="form-group">
        <label>T√©l√©phone</label>
        <input type="tel" id="telephone" placeholder="034 00 000 00" />
      </div>
      <div class="form-group">
        <label>Date de Naissance</label>
        <input type="date" id="dateNaissance" />
      </div>
      <div class="form-group">
        <label>Adresse</label>
        <input type="text" id="adresse" />
      </div>
      <div class="form-group">
        <label>√âglise</label>
        <input type="text" id="eglise" />
      </div>
      <div class="form-group">
        <label>Profession</label>
        <input type="text" id="profession" />
      </div>

      <div class="form-group">
        <label>Option d'apprentissage *</label>
        <div class="radio-group">
          <label class="radio-label" onclick="selectOption('Journalier')">
            Journalier
            <input type="radio" name="option" value="Journalier" />
          </label>
          <label class="radio-label" onclick="selectOption('Weekend')">
            Weekend
            <input type="radio" name="option" value="Weekend" />
          </label>
        </div>
        <input type="hidden" id="optionSelected" />
      </div>
    </div>

    <h2>üå≥ D√©tails Tree (Parrainage)</h2>
    <div class="card">
      <div class="form-group">
        <label>ID Application</label>
        <input type="text" id="idApp" />
      </div>
      <div class="form-group">
        <label>Nom Tree (Contact)</label>
        <input type="text" id="nomTree" />
      </div>
      <div class="form-group">
        <label>Num√©ro Tel Tree</label>
        <input type="tel" id="telTree" />
      </div>
      <div class="form-group">
        <label>Liaison (P√®re, M√®re, Ami...)</label>
        <input type="text" id="liaison" />
      </div>
      <div class="form-group">
        <label>D√©partement / Classe</label>
        <input type="text" id="departement" />
      </div>
    </div>

    <div class="spacer"></div>

    <button id="main-btn" onclick="submitForm()">ENREGISTRER LE DOSSIER</button>

    <script>
      const tg = window.Telegram.WebApp;
      tg.expand(); // Plein √©cran

      // Gestion jolie des boutons radio
      function selectOption(value) {
        document.getElementById("optionSelected").value = value;
        document
          .querySelectorAll(".radio-label")
          .forEach((el) => el.classList.remove("selected"));
        event.currentTarget.classList.add("selected");
      }

      async function submitForm() {
        // 1. R√©cup√©ration des donn√©es
        const data = {
          nomComplet: document.getElementById("nomComplet").value,
          telephone: document.getElementById("telephone").value,
          dateNaissance: document.getElementById("dateNaissance").value,
          adresse: document.getElementById("adresse").value,
          eglise: document.getElementById("eglise").value,
          profession: document.getElementById("profession").value,
          option: document.getElementById("optionSelected").value,

          idApp: document.getElementById("idApp").value,
          nomTree: document.getElementById("nomTree").value,
          telTree: document.getElementById("telTree").value,
          liaison: document.getElementById("liaison").value,
          departement: document.getElementById("departement").value,
        };

        // 2. Validation minimale
        if (!data.nomComplet || !data.option) {
          tg.showAlert("Veuillez remplir le Nom et choisir une Option.");
          return;
        }

        // Changement texte bouton pour feedback
        const btn = document.getElementById("main-btn");
        btn.innerText = "Envoi en cours...";
        btn.disabled = true;

        try {
          // 3. Envoi au serveur (Backend)
          await fetch("/api/students", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          // 4. Signal au Bot que c'est fini et fermeture
          // On renvoie juste le nom pour que le bot confirme la r√©ception
          tg.sendData(data.nomComplet);
        } catch (error) {
          tg.showAlert("Erreur r√©seau : " + error.message);
          btn.innerText = "R√âESSAYER";
          btn.disabled = false;
        }
      }
    </script>
  </body>
</html>
